{% extends "layout.html" %}
{% block title %}Audiobooks{% endblock %}

{% block main %}
<div id="custom-modal" class="modal">
  <div class="modal-content">
    <h5 class="mb-3">Criar flashcard (Create flashcard)</h5>

    <div class="mb-2">
      <label for="modal-question" class="form-label">
        Question <small>(Pergunta)</small>
      </label>
      <textarea id="modal-question" class="form-control" rows="3"></textarea>
    </div>

    <div class="mb-3">
      <label for="modal-answer" class="form-label">
        Answer <small>(Resposta)</small>
      </label>
      <textarea id="modal-answer" class="form-control" rows="3"></textarea>
    </div>

    <div class="d-flex gap-2 justify-content-center">
      <button class="modal-btn btn btn-outline-light" id="flipBtn" type="button">
        Invert Q ↔ A
      </button>
      <button class="modal-btn btn btn-primary" id="yesBtn" type="button">
        Add
      </button>
      <button class="modal-btn btn btn-secondary" id="noBtn" type="button">
        Cancel
      </button>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-12">

      <div class="pt-4">
       {% if audiobook %}

      <div class="p-3 mb-3 bg-body-tertiary rounded-3 border">
        <div class="d-flex align-items-start gap-2">
          
          <div>
            <p class="mb-1">
              Your teacher has added an audiobook for you. Listen to the audio and use the text below
              to select words/phrases, see the translation, and create flashcards.
            </p>
            <small class="text-muted fst-italic">
              (Seu professor adicionou um audiobook para você. Ouça o áudio e use o texto
              abaixo para selecionar palavras/frases, ver a tradução e criar flashcards.)
            </small>
          </div>
        </div>
      </div>
        {% else %}
          <p>
            Upload your audio and text files (.txt format). When you select a word or phrase,
            you can see the translation and create flashcards.
          </p>
          <p>
            <small>
              (Carregue seu arquivo de áudio e texto (formato .txt). Ao selecionar uma palavra
              ou frase, veja a tradução e crie flashcards.)
            </small>
          </p>
        {% endif %}
      </div>

      {% if audiobook %}
        {% if audiobook.audio_url %}
        {# --- SERVER-PROVIDED AUDIOBOOK --- #}
        <br>
        <audio id="audio-player"
        controls
        class="mt-3 d-block mx-auto"
        style="width: 350px; max-width: 100%;">
            <source src="{{ audiobook.audio_url }}" type="audio/mpeg">
          Your browser does not support the audio element.
        </audio>
        {% endif %}

        
        <br>
        {% if audiobook %}
          {% if audiobook.title %}
            <h3 class="mb-2">{{ audiobook.title }}</h3>
          {% endif %}
        {% endif %}
        <pre id="text-content" class="mt-3">{{ text_content }}</pre>

        {# Keep these hidden if your JS expects them #}
        <input type="file" id="audio-input" accept="audio/*" hidden>
        <input type="file" id="text-input" accept=".txt" hidden>

      {% else %}
        {# --- ORIGINAL LOCAL-UPLOAD FLOW --- #}

        <input type="file" id="audio-input" accept="audio/*" hidden>
        <input type="file" id="text-input" accept=".txt" hidden>

        <button id="load-audio" class="btn btn-primary">
          Load Audio <small>(Carregar áudio)</small>
        </button>
        <button id="load-text" class="btn btn-primary">
          Load Text <small>(Carregar texto)</small>
        </button>

        <audio id="audio-player" controls style="display:none;" class="mt-3"></audio>
  



        <pre id="text-content" style="display:none;" class="mt-3"></pre>
      {% endif %}

    </div>
  </div>
</div>

    

<script src="{{ url_for('static', filename='js/audiobook.js') }}"></script>
{% endblock %}
