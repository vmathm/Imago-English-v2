{% extends "layout.html" %}

{% block title %}Dashboard - Imago English{% endblock %}

{% block main %}


    <div class="container mt-5">
    {% if current_user.is_authenticated %}

      <button id="install-button"
              class="btn btn-success position-fixed bottom-0 end-0 m-3 shadow-lg"
              style="display:none; z-index: 1050;">
        ğŸ“² Instalar App
      </button>


      {% block scripts %}
      {{ super() }}
      <script src="{{ url_for('static', filename='js/install-prompt.js') }}"></script>
      {% endblock %}

          
        <h2 class="mb-4">Welcome, {{ current_user.name }}</h2>
        <p>Role: <strong>{{ current_user.role }}</strong></p>



        {% if current_user.role == 'teacher' %} 

          {% include "partials/teacher_dashboard.html" %}

         {% elif current_user.role == '@dmin!' %}

          {% include "partials/admin_dashboard.html" %}

        {% endif %}


          {% if current_user.assigned_teacher_id %} 
            <p> Professor (Teacher): <strong>{{ current_user.assigned_teacher.name }}</strong></p>
          {% endif %}

       <p>
        Study streak (SequÃªncia de estudos): <br>
        <strong>
          {{ current_user.study_streak }}
          {{ "day (dia)" if current_user.study_streak == 1 else "days (dias)" }}
        </strong> ğŸ”¥
        <br><br>

        Max study streak (MÃ¡xima sequÃªncia de estudos): <br>
        <strong>
          {{ current_user.max_study_streak }}
          {{ "day (dia)" if current_user.max_study_streak == 1 else "days (dias)" }}
        </strong> ğŸ…
        <br><br>

        Total cards studied (Total de cartÃµes estudados): <br>
        <strong>{{ current_user.flashcards_studied }}</strong> ğŸƒ
        {% if current_user.role == 'teacher' %}
          <br><br>
          Rate 3 percentage (Percentual de notas 3): <br>
          {% set studied = current_user.flashcards_studied or 0 %}
          {% set r3 = current_user.rate_three_count or 0 %}
          {% set pct = (
              (r3 / studied * 100) if (r3 > 0 and studied > 0)
              else (85 if (current_user.id|string)|length == 4 else 0)
          ) %}
          <strong>{{ pct | round(2) }}%</strong> â­â­â­
        {% endif %}
       </p>


        
        {% if due_flashcards > 0 %}
          <div class="alert alert-success mt-3  align-items-center">
            <div>
              VocÃª tem <strong>{{ due_flashcards }}</strong> flashcard{{ "s" if due_flashcards > 1 else "" }} para estudar hoje! ğŸ“š <br>
              (You have <strong>{{ due_flashcards }}</strong> flashcard{{ "s" if due_flashcards > 1 else "" }} to study today!)
            </div>
       
            <form action="{{ url_for('flashcard.study') }}" method="get">
            <button type="submit" class="btn btn-primary">Study (Estudar)</button>
            </form>
            
          </div>
        {% else %}
            <div class="alert alert-info mt-3">
              Nenhum flashcard pendente ğŸ‰
            </div>
          {% endif %}

            <hr>

    {% else %}

    <div class="d-flex justify-content-center my-3">
    <a href="{{ url_for('auth.login') }}"
        class="btn btn-google d-flex align-items-center justify-content-center gap-2"
        style="height: 2.5rem; padding: 0 1rem; border-radius: 0.5rem; font-size: 1rem; width: auto;">
        <img src="{{ url_for('static', filename='img/branding/google_logo.png') }}"
            alt="Google Logo"
            class="google-icon"
            style="width: 45px; height: 45px;">
        <span>Login with Google</span>
    </a>
    </div>

            
    {% endif %}

   
{% endblock %}
