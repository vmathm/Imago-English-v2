{% extends "layout.html" %}

{% block title %}Rankings{% endblock %}

{% block main %}
<section id="leaderboard">
<div class="container mt-5">

    <div class="container section-box my-4">
        <h3>Top 3 Students of All Time</h3>
        <div class="table-wrapper">
            <table id="top-table" class="table table-striped text-center">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name (Nome)</th>
                        <th>Highest Streak (Maior sequÃªncia de dias)</th>
                        <th>Highest Score (Maior pontuaÃ§Ã£o)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in top_students %}
                    <tr>
                        <td></td>
                        <td>{{ student.name }}</td>
                        <td>{{ student.max_study_streak if student.max_study_streak else 0 }}</td>
                        <td>{{ student.max_points }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="container section-box my-4">
        <h3 class="mt-5">Student Ranking</h3>
        <div class="table-wrapper">
            <table id="student-table" class="table table-striped text-center">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name (Nome)</th>
                        <th>Points (Pontos)</th>
                        <th>Streak (SequÃªncia de dias)</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    <tr>
                        <td></td>
                        <td>{{ student.name }}</td>
                        <td>{{ student.points }}</td>
                        <td>{{ student.study_streak }}</td>
                        <td>{{ student.points if student.study_streak == 0 else student.study_streak * student.points }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="container section-box my-4">
        <h3 class="mt-5">Teacher Ranking</h3>
        <div class="table-wrapper">
            <table id="teacher-table" class="table table-striped text-center">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name (Nome)</th>
                        <th>Points (Pontos)</th>
                        <th>Streak (SequÃªncia de dias)</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for teacher in teachers %}
                    <tr>
                        <td></td>
                        <td>{{ teacher.name }}</td>
                        <td>{{ teacher.points }}</td>
                        <td>{{ teacher.study_streak }}</td>
                        <td>{{ teacher.points if teacher.study_streak == 0 else teacher.study_streak * teacher.points }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
</section>


<div id="rotate-to-landscape" class="alert alert-info text-center my-3">
  Please rotate your device to landscape to view the leaderboard. <br>
  (Por favor, gire o dispositivo para a horizontal para ver o ranking.)<br>
ğŸ“±â†”ï¸
</div>
<!-- DataTables setup -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
$(document).ready(function () {
  const setupTable = (selector, defaultOrderCol) => {
    const table = $(selector).DataTable({
      order: [[defaultOrderCol, 'desc']],
      searching: false,
      paging: false,
      info: false,
      columnDefs: [{ targets: 0, orderable: false }] // "#" column
    });

    table.on('order.dt search.dt', function () {
      table
        .column(0, { search: 'applied', order: 'applied' })
        .nodes()
        .each(function (cell, i) {
          cell.textContent = i + 1;   // â† no innerHTML
        });
    }).draw();
  };

  setupTable('#top-table', 3);      // order by Highest Score
  setupTable('#student-table', 4);  // order by Total
  setupTable('#teacher-table', 4);  // order by Total
});

</script>

{% endblock %}
