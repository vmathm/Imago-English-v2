{% extends "layout.html" %}

{% block title %}Ranking{% endblock %}

{% block main %}
<div class="container mt-5">
    <h1 class="mb-4">Leaderboards</h1>

    <div class="container section-box my-4">
        <h3>Top 3 Students of All Time</h3>
        <div class="table-wrapper">
            <table id="top-table" class="table table-striped text-center">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Sequência (dias)</th>
                        <th>Pontos</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in top_students %}
                    <tr>
                        <td></td>
                        <td>{{ student.name }}</td>
                        <td>{{ student.study_streak if student.study_streak else 0 }}</td>
                        <td>{{ student.points }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="container section-box my-4">
        <h3 class="mt-5">Student Ranking</h3>
        <div class="table-wrapper">
            <table id="student-table" class="table table-striped text-center">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Nome</th>
                        <th>Pontos</th>
                        <th>Sequência (dias)</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    <tr>
                        <td></td>
                        <td>{{ student.name }}</td>
                        <td>{{ student.points }}</td>
                        <td>{{ student.study_streak }}</td>
                        <td>{{ student.points if student.study_streak == 0 else student.study_streak * student.points }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="container section-box my-4">
        <h3 class="mt-5">Teacher Ranking</h3>
        <div class="table-wrapper">
            <table id="teacher-table" class="table table-striped text-center">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Nome</th>
                        <th>Pontos</th>
                        <th>Sequência (dias)</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for teacher in teachers %}
                    <tr>
                        <td></td>
                        <td>{{ teacher.name }}</td>
                        <td>{{ teacher.points }}</td>
                        <td>{{ teacher.study_streak }}</td>
                        <td>{{ teacher.points if teacher.study_streak == 0 else teacher.study_streak * teacher.points }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- DataTables setup -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
  $(document).ready(function () {
    const setupTable = (selector, defaultOrderCol) => {
      const table = $(selector).DataTable({
        order: [[defaultOrderCol, 'desc']],
        searching: false,
        paging: false,
        info: false
      });

      // Auto-number the first column based on current order
      table.on('order.dt search.dt', function () {
        table
          .column(0, { search: 'applied', order: 'applied' })
          .nodes()
          .each(function (cell, i) {
            cell.innerHTML = i + 1;
          });
      }).draw();
    };

    setupTable('#top-table', 3);      
    setupTable('#student-table', 4);  
    setupTable('#teacher-table', 4);  
  });
</script>

{% endblock %}
